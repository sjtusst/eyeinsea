name: Supabase Anti-Pause Bot

on:
  schedule:
    # 修改这里：每隔两天的 UTC 18:00 (北京时间凌晨 2:00) 触发
    - cron: '0 18 */2 * *'
  workflow_dispatch: # 保持不变，允许手动触发

jobs:
  keep_alive:
    runs-on: ubuntu-latest
    steps:
      - name: Random Delay and Request
        run: |
          # 随机等待 1 到 21600 秒（即 0 到 6 小时）
          # 既能打乱规律，又不会让脚本运行时间过长
          SLEEP_TIME=$(( RANDOM % 21600 ))
          echo "为了模拟真实行为，将随机等待 $SLEEP_TIME 秒后发起请求..."
          sleep $SLEEP_TIME
          
          echo "开始访问数据库..."
          curl -i -X GET "${{ secrets.SUPABASE_URL }}/rest/v1/${{ secrets.TABLE_NAME }}?select=*" \
          -L \
          -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
          -H "Range: 0-0"
          
          echo "任务完成！心跳包已发送。"
